<script type="text/x-red" data-template-name="aiware-crud">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <select id="node-input-object" style="width:66%">
            <option value="watchlist">Watchlist</option>
            <option value="collection">Collection</option>
        </select>
    </div>
    <div class="form-row">
        <select id="node-input-action" style="width:66%">
            <option value="create">Create</option>
            <option value="query">Query</option>
            <option value="update">Update</option>
            <option value="delete">Delete</option>
        </select>
    </div>
    <div id="input-for-crud-data"></div>
  </script>

<script type="text/x-red" data-help-name="aiware-crud">
    <p>Webhook endpoint for Veritone events</p>
  </script>

<script type="text/javascript">
    (function () {
        const crudKey = (object, action) => `${object}.${action}`;
        const crudDataNode = () => $("#input-for-crud-data");
        const crudData = (key, data) => crudDataNode().val(key, data);
        const createWatchlist = {
            type: 'object',
            title: 'Create Watchlist',
            required: ['stopDateTime', 'name'],
            properties: [
                { startDateTime: { type: 'string' } },
                { stopDateTime: { type: 'string' } },
                { sourceTypeIds: { type: 'array', items: { type: 'string' } } },
                { sourceId: { type: 'array', items: { type: 'string' } } },
                { details: { type: 'object' } }
            ]
        }
        const params = {
            'watchlist.create': {
                startDateTime: { type: 'str' }
            }
        }

        RED.nodes.registerType('aiware-crud', {
            category: 'aiWARE',
            color: "#b3e5fc",
            defaults: {
                name: { value: "" },
                object: { value: "" },
                action: { value: "" },
                data: { value: {} }
            },
            inputs: 1,
            outputs: 2,
            outputLabels: ["result", "error"],
            icon: "veritone-logo-transparent.png",
            paletteLabel: "aiware-crud",
            label: function () {
                return this.name || "aiWARE crud";
            },
            oneditprepare: function () {
                const { object, action } = this;
                this.data = this.data || {};
                // set data into node
                const key = crudKey(object, data);
                const data = this.data[key] || {};
                crudData(key, data);
                const schema = createWatchlist;
            },
            oneditsave: function () {
                const { object, action } = this;
                const key = crudKey(object, data);
                const data = crudData(key);
                this.data[key] = data;
            }
        });
    })();
</script>